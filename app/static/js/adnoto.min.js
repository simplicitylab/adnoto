var Note=Backbone.Model.extend({url:function(){return"test_json/note.json"}}),Notebook=Backbone.Model.extend({urlRoot:"api/v1/notebook"}),Notebooks=Backbone.Collection.extend({model:Notebook,url:"api/v1/notebooks",parse:function(a){return a.notebooks}}),Notes=Backbone.Collection.extend({model:Note,initialize:function(a,b){this.notebook_id=b.notebook_id},url:function(){return"test_json/notes.json"}}),NoteColorPickerView=Backbone.View.extend({el:$("#note-color-picker"),initialize:function(){var a=this;$(window).bind("click",function(b){if(a.isVisible())if(0==$(b.target).hasClass("circle"))$("#note-color-picker").popover("hide");else{var c=$(b.target).data("note-color");a.setColor(c),$("#note-color-picker").popover("hide")}})},setColor:function(a){$("#color-preview").removeClass().addClass("circle big "+a),adnoto_app.noteView.setNoteColor(a)},isVisible:function(){return this.visible},popupColorContent:function(){var a=_.template($("#template-color-picker").html());return a()},events:{click:function(){var a=this;$("#note-color-picker").popover({html:!0,placement:"bottom",trigger:"manual",content:a.popupColorContent}).popover("show")},"shown.bs.popover":function(){this.visible=!0},"hidden.bs.popover":function(){this.visible=!1}}}),NoteView=Backbone.View.extend({initialize:function(){this.MDWriter=new commonmark.HtmlRenderer,this.MDReader=new commonmark.DocParser,this.initMarkdownEditor(),$("#markdownEditor").hide(),$("#markdownPreview").hide(),this.mode="html"},initMarkdownEditor:function(){this.markdownEditor=CodeMirror($("#markdownEditor")[0],{value:"",mode:"markdown"})},setNoteColor:function(a){this.color=a},getNote:function(a){var b=this;this.note=new Note({id:a}),this.note.fetch({success:function(a){b.note_id=a.id,$("#note-title").html(a.get("title")),b.markdownEditor.setValue(a.get("content")),adnoto_app.enableContentButtons(),b.showMarkdownPreview()}})},newNote:function(){this.note_id=void 0,this.markdownEditor.setValue(""),$("#note-title").html(""),this.showMarkdownEditor()},saveNote:function(){console.log("save note "+this.note_id)},deleteNote:function(){console.log("delete note "+this.note_id)},toggleMode:function(){"html"===this.mode?(this.mode="markdown",this.showMarkdownEditor()):(this.mode="html",this.showMarkdownPreview()),this.render()},showMarkdownEditor:function(){$("#btn-toggle-mode").html('<span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> View'),$("#markdownEditor").show(),$("#markdownPreview").hide(),this.markdownEditor.refresh()},showMarkdownPreview:function(){$("#btn-toggle-mode").html('<span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Edit'),this.markdownContent=this.markdownEditor.getValue();var a=this.MDReader.parse(this.markdownContent),b=this.MDWriter.renderBlock(a);$("#markdownPreview").html(b),$("#markdownEditor").hide(),$("#markdownPreview").show(),Prism.highlightAll()}}),NoteBooksView=Backbone.View.extend({el:$("#list-notebooks"),initialize:function(){this.collection=new Notebooks,this.refreshNotebooks()},refreshNotebooks:function(){var a=this;void 0!=this.collection&&this.collection.fetch({success:function(){a.render()}})},events:{"click a":function(a){$("#list-notebooks>li.active").removeClass("active");$(a.target).data("notebook-id");$(a.target).closest("li").addClass("active")},"click i.delete-notebook":function(a){var b=$(a.target).data("notebook-id");$("#dlg-delete-notebook-input-notebook-name").val("");var c=$(a.target).next("a").html();$("#dlg-delete-noteboook-span-notebook-name").html(c),$("#dlg-delete-notebook-hidden-notebook-id").val(b),$("#dlg-delete-notebook").modal("show")}},render:function(){var a=_.template($("#template-notebooks-list").html());this.$el.html(a({notebooks:this.collection.models}))}}),NotesView=Backbone.View.extend({el:$("#list-group-container"),initialize:function(){},showNotes:function(a){var b=this;this.collection=new Notes([],{notebook_id:a}),this.collection.fetch({success:function(){b.render()}})},filterNotes:function(a){this.filter=a.length>0?a:void 0,this.render()},events:{"click .list-group-item":function(a){$("#list-group-container>a.active").removeClass("active");$(a.currentTarget).data("note-id");$(a.currentTarget).addClass("active")}},render:function(){var a=this,b=_.template($("#template-notes-list").html());if(void 0!=this.filter){var c=_.filter(this.collection.models,function(b){return b.get("title").toLowerCase().indexOf(a.filter.toLowerCase())>-1});this.$el.html(b({notes:c}))}else this.$el.html(b({notes:this.collection.models}))}});adnoto_app.enableContentButtons=function(){$("#btn-toggle-mode").removeAttr("disabled"),$("#btn-delete-note").removeAttr("disabled"),$("#btn-save-note").removeAttr("disabled")};var setupViews=function(){adnoto_app.noteColorPickerView=new NoteColorPickerView,adnoto_app.notebooksListView=new NoteBooksView,adnoto_app.notesListView=new NotesView,adnoto_app.notesListView.showNotes(1),adnoto_app.noteView=new NoteView,adnoto_app.noteView.getNote(1)};$(document).ready(function(){$(window).bind("resize",function(){adnoto_app.updateLayoutElements()}),$("#menu_notebook_rename").bind("click",function(){$("#dlg-rename-notebook-input-notebook-name").val(""),$("#dlg-rename-notebook").modal("show")}),$("#add-notebook-container").bind("click",function(){$("#dlg-new-notebook").modal("show")}),$("#btn-new-note").bind("click",function(){$("#dlg-new-note").modal("show")}),$("#btn-toggle-mode").bind("click",function(){adnoto_app.noteView.toggleMode()}),$("#btn-delete-note").bind("click",function(){var a=$("#list-group-container").find(".active").find("h4").html();$("#dlg-delete-note-span-note-name").html(a),$("#dlg-delete-note-input-note-name").val(""),$("#dlg-delete-note").modal("show")}),$("#btn-save-note").bind("click",function(){adnoto_app.noteView.saveNote()}),$("#input-search").keyup(function(){adnoto_app.notesListView.filterNotes($(this).val())}),$("#dlg-new-notebook-btn-create").bind("click",function(){var a=$("#dlg-new-notebook-input-notebook-name").val();if(a.length>0){$("#dlg-new-notebook").modal("hide");var b=new Notebook;b.set({name:a}),b.save(),adnoto_app.notebooksListView.refreshNotebooks()}}),$("#dlg-delete-notebook-btn-delete").bind("click",function(){var a=$("#dlg-delete-noteboook-span-notebook-name").html();if(a==$("#dlg-delete-notebook-input-notebook-name").val()){$("#dlg-delete-notebook").modal("hide");var b=$("#dlg-delete-notebook-hidden-notebook-id").val(),c=new Notebook({id:b});c.destroy(),adnoto_app.notebooksListView.refreshNotebooks()}}),$("#dlg-new-note-btn-create").bind("click",function(){var a=$("#dlg-delete-note-span-note-name").html();a.length>0&&($("#dlg-new-note").modal("hide"),console.log("create new note : "+a))}),$("#dlg-delete-note-btn-delete-note").bind("click",function(){var a=$("#list-group-container").find(".active").find("h4").html();a==$("#dlg-delete-note-input-note-name").val()&&$("#dlg-delete-note").modal("hide")}),setupViews(),$(window).trigger("resize")}),adnoto_app.layout={},adnoto_app.calculateLayoutProperties=function(){void 0==adnoto_app.layout.topBarHeight&&(adnoto_app.layout.topBarHeight=$("#top-navbar").outerHeight()),void 0==adnoto_app.layout.notesBarHeight&&(adnoto_app.layout.notesBarHeight=$("#notes-navbar").outerHeight()),void 0==adnoto_app.layout.editorContentBarHeight&&(adnoto_app.layout.editorContentBarHeight=$("#editor-content-navbar").outerHeight()),void 0==adnoto_app.layout.notebookSectionTitleHeight&&(adnoto_app.layout.notebookSectionTitleHeight=$("#notebook-section-title").outerHeight()),void 0==adnoto_app.layout.noteTitleHeight&&(adnoto_app.layout.noteTitleHeight=$("#note-title").outerHeight()),void 0==adnoto_app.layout.sidebarNotebooksWidth&&(adnoto_app.layout.sidebarNotebooksWidth=$("#sidebar-notebooks-tags").outerWidth()),void 0==adnoto_app.layout.sidebarNotesWidth&&(adnoto_app.layout.sidebarNotesWidth=$("#sidebar-notes").outerWidth()),adnoto_app.layout.viewportHeight=$(window).height(),adnoto_app.layout.viewportWidth=$(window).width(),adnoto_app.layout.mainContainerHeight=adnoto_app.layout.viewportHeight-adnoto_app.layout.topBarHeight,adnoto_app.layout.mainElementsHeight=adnoto_app.layout.viewportHeight-adnoto_app.layout.topBarHeight,adnoto_app.layout.contentEditorWidth=adnoto_app.layout.viewportWidth-(adnoto_app.layout.sidebarNotebooksWidth+adnoto_app.layout.sidebarNotesWidth),adnoto_app.layout.listNotesContainerHeight=adnoto_app.layout.viewportHeight-adnoto_app.layout.topBarHeight-adnoto_app.layout.notesBarHeight,adnoto_app.layout.listNotebooksContainer=adnoto_app.layout.viewportHeight-adnoto_app.layout.topBarHeight-adnoto_app.layout.notebookSectionTitleHeight-20,adnoto_app.layout.contentContainerHeight=adnoto_app.layout.viewportHeight-adnoto_app.layout.topBarHeight-adnoto_app.layout.noteTitleHeight-adnoto_app.layout.editorContentBarHeight-60},adnoto_app.updateLayoutElements=function(){adnoto_app.calculateLayoutProperties(),$("#main-container").css("height",adnoto_app.layout.mainContainerHeight+"px"),$("#sidebar-notebooks-tags").css("height",adnoto_app.layout.mainElementsHeight+"px"),$("#sidebar-notes").css("height",adnoto_app.layout.mainElementsHeight+"px"),$("#content-editor-container").css("height",adnoto_app.layout.mainElementsHeight+"px"),$("#list-group-container").css("height",adnoto_app.layout.listNotesContainerHeight+"px"),$("#list-notebooks-container").css("height",adnoto_app.layout.listNotebooksContainer+"px"),$("#content-editor-container").css("width",adnoto_app.layout.contentEditorWidth+"px"),$("#content-container").css("height",adnoto_app.layout.contentContainerHeight+"px")};